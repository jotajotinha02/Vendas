<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Contabilidade - Vendas</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
    .card-container { max-width: 90%; margin: 2rem auto; }
    .action-button { transition: all 0.2s; }
    .action-button:hover { transform: scale(1.05); opacity: 0.8; }
  </style>
</head>
<body class="bg-gray-100 flex items-start justify-center min-h-screen p-4">
  <div class="card-container bg-white shadow-xl rounded-2xl p-6 md:p-8 w-full lg:max-w-4xl">
    <h1 class="text-3xl md:text-4xl font-bold text-center text-gray-800 mb-6">Registrar Venda</h1>

    <form id="venda-form" class="space-y-4">
      <div class="flex flex-col md:flex-row md:space-x-4 space-y-4 md:space-y-0">
        <input id="usuario" type="text" placeholder="Usu√°rio" required class="flex-1 p-3 rounded-xl border border-gray-300" />
        <input id="quantidade" type="number" placeholder="Quantidade" required class="flex-1 p-3 rounded-xl border border-gray-300" />
        <input id="valor" type="number" step="0.01" placeholder="Valor (R$)" required class="flex-1 p-3 rounded-xl border border-gray-300" />
      </div>
      <button type="submit" class="w-full bg-green-600 text-white font-bold p-3 rounded-xl hover:bg-green-700 transition-colors">Registrar</button>
    </form>

    <div class="my-8 h-px bg-gray-200"></div>

    <h2 class="text-2xl font-semibold text-gray-800 mb-2">Filtro por usu√°rio:</h2>
    <div class="flex flex-col md:flex-row md:items-center md:space-x-4 space-y-4 md:space-y-0">
      <input id="filtro-usuario" type="text" placeholder="Nome do usu√°rio" class="flex-1 p-3 rounded-xl border border-gray-300" />
      <button id="buscar-button" class="w-full md:w-auto bg-blue-600 text-white font-bold p-3 rounded-xl hover:bg-blue-700 transition-colors">Buscar</button>
    </div>

    <p class="text-lg font-medium text-gray-700 mt-4">
      Total vendido: <span id="total-vendido" class="font-bold text-green-600">R$ 0,00</span><br>
      Total de unidades: <span id="total-quantidade" class="font-bold text-blue-600">0</span>
    </p>

    <div class="overflow-x-auto mt-6 rounded-xl shadow-sm border border-gray-200">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">Usu√°rio</th>
            <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">Quantidade</th>
            <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">Valor (R$)</th>
            <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">Data</th>
            <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">A√ß√µes</th>
          </tr>
        </thead>
        <tbody id="vendas-tabela-corpo" class="bg-white divide-y divide-gray-200"></tbody>
      </table>
    </div>
  </div>

  <script>
    // üî• Inicializar Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAsBm8_rX3BlUv1eSCWUJO5rqF-p9mBhic",
      authDomain: "hydra-61a32.firebaseapp.com",
      projectId: "hydra-61a32",
      storageBucket: "hydra-61a32.firebasestorage.app",
      messagingSenderId: "179524818640",
      appId: "1:179524818640:web:56ceb938720574e85f30d5",
      measurementId: "G-FWRF1DRTRH"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // üîß Refer√™ncias do DOM
    const vendaForm = document.getElementById('venda-form');
    const usuarioInput = document.getElementById('usuario');
    const quantidadeInput = document.getElementById('quantidade');
    const valorInput = document.getElementById('valor');
    const filtroInput = document.getElementById('filtro-usuario');
    const buscarButton = document.getElementById('buscar-button');
    const totalVendidoSpan = document.getElementById('total-vendido');
    const totalQuantidadeSpan = document.getElementById('total-quantidade');
    const tabelaCorpo = document.getElementById('vendas-tabela-corpo');

    const formatarMoeda = valor => new Intl.NumberFormat('pt-BR', {
      style: 'currency', currency: 'BRL'
    }).format(valor);

    const carregarVendas = async (filtro = '') => {
      tabelaCorpo.innerHTML = '';
      let totalValor = 0;
      let totalQtd = 0;

      let query = db.collection('vendas');
      if (filtro) query = query.where('usuario', '==', filtro);

      const snapshot = await query.orderBy('data', 'desc').get();

      snapshot.forEach(doc => {
        const venda = doc.data();
        totalValor += Number(venda.valor);
        totalQtd += Number(venda.quantidade);

        const row = tabelaCorpo.insertRow();
        row.innerHTML = `
          <td class="px-6 py-4">${venda.usuario}</td>
          <td class="px-6 py-4">${venda.quantidade}</td>
          <td class="px-6 py-4">${formatarMoeda(venda.valor)}</td>
          <td class="px-6 py-4">${venda.data}</td>
          <td class="px-6 py-4">
            <button class="text-red-600 hover:text-red-900 action-button" onclick="excluirVenda('${doc.id}')">Excluir</button>
          </td>
        `;
      });

      totalVendidoSpan.textContent = formatarMoeda(totalValor);
      totalQuantidadeSpan.textContent = totalQtd;
    };

    const excluirVenda = async (id) => {
      await db.collection('vendas').doc(id).delete();
      carregarVendas(filtroInput.value.trim());
    };

    vendaForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const venda = {
        usuario: usuarioInput.value.trim(),
        quantidade: Number(quantidadeInput.value),
        valor: Number(valorInput.value),
        data: new Date().toLocaleString('pt-BR')
      };
      await db.collection('vendas').add(venda);
      vendaForm.reset();
      carregarVendas();
    });

    buscarButton.addEventListener('click', () => {
      carregarVendas(filtroInput.value.trim());
    });

    filtroInput.addEventListener('input', () => {
      carregarVendas(filtroInput.value.trim());
    });

    document.addEventListener('DOMContentLoaded', () => {
      carregarVendas();
    });
  </script>
</body>
</html>
